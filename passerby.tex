%-----------------------------------------------------------------------
% Beginning of article-template.tex
%-----------------------------------------------------------------------
%
%    This is a template file for proceedings articles prepared with AMS
%    author packages, for use with AMS-LaTeX.
%
%    Templates for various common text, math and figure elements are
%    given following the \end{document} line.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%    Remove any commented or uncommented macros you do not use.

%    Replace amsproc by the name of the author package.
\documentclass{amsart}

%    If you need symbols beyond the basic set, uncomment this command.
%\usepackage{amssymb}

%    If your article includes graphics, uncomment this command.
%\usepackage{graphicx}

%    If the article includes commutative diagrams, ...
%\usepackage[cmtip,all]{xy}

%    Include other referenced packages here.
% \usepackage{}
\usepackage{hyperref}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{fancyvrb}
\usepackage{amsmath}
% See http://tex.stackexchange.com/questions/32051/variable-sized-such-that-pipe
% For usage of /Set that depends on braket
\usepackage{braket}
% For showing images:
% \usepackage{svg}
% For showing text images:
% \usepackage{pstricks}

% For showing images:
\usepackage{graphicx}
% \usepackage{svg}

%    Update the information and uncomment if AMS is not the copyright
%    holder.
%\copyrightinfo{2009}{American Mathematical Society}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{xca}[theorem]{Exercise}

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}

\numberwithin{equation}{section}

\DeclareMathOperator*{\argmin}{arg\,min}
\newcommand{\divides}{\mid}

\begin{document}


\title{Passerby messaging system}
%    Only \author and \address are required; other information is
%    optional.  Remove any unused author tags.

%    author one information
% \author[short version for running head]{name for top of paper}
\author{real}
% \address{freedomlayer}
% \curraddr{}
\email[real]{real@freedomlayer.org}
\thanks{Freedomlayer research facility}

%    author two information
% \author{}
% \address{}
% \curraddr{}
% \email{}
% \thanks{}

% \subjclass[2000]{Primary}
%    The 2010 edition of the Mathematics Subject Classification is
%    now available.  If you are citing a classification from the
%    new scheme, use the following input coding instead.
% See http://www.ams.org/msc/msc2010.html?t=05C30&btn=Current for explanation.
\subjclass[2010]{Primary 05C30}

\date{22.06.2017}
\maketitle

\begin{abstract}
  Passerby is an experimental messaging system that allows real time anonymous
  and encrypted messaging. This document describes the protocol being used in
  Passerby.
\end{abstract}

\section{Main goals}

Main goals of the Passerby system:

\begin{enumerate}
  \item Passing messages between people with high probability of success.
  \item Encrypting the messages passed between people.
  \item Keeping a contact list.
\end{enumerate}


\section{Low level API messages}

Possible messages to send to the Passerby router:
\begin{enumerate}
  \item $CreateChannel (remote_id)$
  \item $SendMessage (remote_id, datagram_data)$
  \item $CloseChannel (remote_id)$
\end{enumerate}

Possible messages to receive from the Passerby router:
\begin{enumerate}
  \item $MessageReceived (remote_id, datagram_data)$
\end{enumerate}

Node ids are of size 120 bits (15 bytes). They are a hash of a public key.

\section{Operation of the Passerby router}

\subsection{Messages between routers}

The Passerby router has direct reliable TCP like connections to various nodes,
implemented somehow. For any direct connection with a neighboring node, the
following messages can be transferred:

Initial handshake:
\begin{enumerate}
  \item $LocalId(LocalShortId)$
      First message sent. Introduces the $LocalShortId$ to the remote side.
\end{enumerate}

The following messages can be sent after the handshake:

\begin{enumerate}
  \item $UpdatedLandmarkPath(SignedPathToLandmark, TimestampsPath)$
      Used both for new choice of landmark, or changes in the network layout.
      Right after the handshake, this kind of message should be sent for all
      landmarks.
  \item $TimeTick(AggrRandom)$
      A time tick, used for implementing distributed time.
  \item $NetCoordMessage(RemoteNetCoord, RemoteShortId, NCMessage)$
    Send a message to a remote node according to RemoteNetCoord.
\end{enumerate}

% TODO: Explain about the structure of NCMessage here.
% Should include how to create and share symmetric encryption key.

The structure of an NCMessage(payload):
\begin{enumerate}
  \item magic
  \item $Enc_{RemoteShortId}(SendSymKey)$ (Usually the same SendSymKey)
  \item Encrypted message (By the symmetric key SendSymKey)
    \begin{enumerate}
      \item padding length (1 byte)
      \item random padding
      \item payload length (4 bytes)
      \item payload
    \end{enumerate}
\end{enumerate}

The following NCMessages are used to maintain channels to remote nodes:

\begin{enumerate}
  \item $ChanNetCoord(SenderNetCoord, RandNonce)$ Current network coordinate. Sent
    periodically (By both sides of the channel) to maintain channel despite
    drift of network coordinates. The receiving end of the channel should send
    the exact same RandNonce, to prove that he can read the messages.
  \item $ContentMessage(content)$
    \begin{enumerate}
      \item $Enc_{RemoteLongId}(ContentSendSymKey)$ Usually the same key
      \item $Enc_{ContentSendSymKey}(payload)$
    \end{enumerate}
\end{enumerate}

The following NCMessages are used to maintain the DHT. They are sent with specific
RemoteNetCoord and RemoteShortId values (Given to NetCoordMessage).

\begin{enumerate}
  \item $DHTRequestClosest(TargetShortId)$
  \item $DHTResponseClosest(ClosestIds(<ShortId, NetCoord>))$
  \item $DHTRequestFingers(Fingers(<ShortId, NetCoord>))$
  \item $DHTResponseFingers(Fingers(<ShortId, NetCoord>))$
\end{enumerate}

% TODO: How to make updating of fingers efficient?
% Currently it seems to be either slow or very bandwidth consuming.
% Possibly do it not very often? Every one minute?

% Maybe we can avoid the DHT if we solve storing information in a random
% network coordinate in the network.

% \subsection{Subsection}


%    Bibliographies can be prepared with BibTeX using amsplain,
%    amsalpha, or (for "historical" overviews) natbib style.
\bibliographystyle{amsplain}
%    Insert the bibliography data here.
\begin{thebibliography}{9}
\bibitem{chord-stoica}
Ion Stoica, Robert Morris, David Karger, M. Frans Kaashoek, Hari Balakrishnan
\textit{Chord: A scalable Peer-to-peer Lookup Service for Internet Applications}
% \\\texttt{http://www.math.ucsd.edu/\~{}ronspubs/81\_04\_small\_trees.pdf}

\bibitem{pushing-chord-overlay}
Thomas Fuhrmann, Pengfei Di, Kendy Kutzner, Curt Cramer
\textit{Pushing Chord into the Underlay: Scalable Routing for Hybrid MANETs}

\bibitem{virtual-ring-routing}
  Matthew Caesar, Miguel Castro, Edmund B. Nightingale, Greg O'Shea, Antony Rowstron
\textit{Virtual Ring Routing: Network Routing Inspired by DHTs}
\\

\end{thebibliography}

\end{document}

